<?xml version="1.0" encoding="UTF-8" ?>
<story id="ShockTrade_NAICS_import">

    <import path="./app-cli/src/test/resources/global_settings.xml" />

    <triggers>
        <StartUpTrigger id="shocktrade_trigger">
            <SimpleFlow id="mongo_to_sql_flow" input-source="mongo_input" output-source="sql_output" />
        </StartUpTrigger>
    </triggers>

    <data-sources>
        <MongoInputSource id="mongo_input"
                          servers="localhost:27017"
                          database="shocktrade"
                          collection="NAICS"
                          layout="mongo_layout">
            <query>{}</query>
        </MongoInputSource>

        <ConcurrentOutputSource id="sql_output" concurrency="10">
            <data-sources>
                <SQLOutputSource id="sql_device"
                                 table="dbo.naics_codes"
                                 layout="sql_layout"
                                 driver="com.microsoft.sqlserver.jdbc.SQLServerDriver"
                                 url="{{ sqlserver.secret.url }}"
                                 user="{{ sqlserver.secret.user }}" password="{{ sqlserver.secret.password }}" />
            </data-sources>
        </ConcurrentOutputSource>
    </data-sources>

    <layouts>
        <MultiPartLayout id="mongo_layout">
            <body>
                <record id="input" format="json">
                    <field name="naicsNumber" type="int" />
                    <field name="description" type="string" />
                </record>
            </body>
        </MultiPartLayout>

        <MultiPartLayout id="sql_layout">
            <body>
                <record id="output" format="none">
                    <field name="naicsNumber" type="int" value="{{ naicsNumber }}"/>
                    <field name="description" type="string" value="{{ description }}"/>
                </record>
            </body>
        </MultiPartLayout>
    </layouts>
</story>