/**
 * New Game Dialog Singleton
 * @author lawrence.daniels@gmail.com
 */
var app = angular.module('shocktrade');
app.factory('NewGameDialog', function ($http, $log, $modal, $q) {
    var service = {};

    /**
     * Sign-up Modal Dialog
     */
    service.popup = function ($scope, successCB, errorCB) {
        // create an instance of the dialog
        var $modalInstance = $modal.open({
            controller: 'NewGameDialogCtrl',
            templateUrl: 'new_game.htm',
            resolve: {
                form: function () {
                    return $scope.form;
                }
            }
        });

        $modalInstance.result.then(function (form) {
            service.createNewGame(form).then(
                function (response) {
                    if (successCB) successCB(response);
                },
                function (err) {
                    if (errorCB) errorCB(err);
                }
            );
        }, function () {
            $log.info('Modal dismissed at: ' + new Date());
        });
    };

    service.createNewGame = function (form) {
        $log.info("Creating new game " + angular.toJson(form));
        var deferred = $q.defer();
        $http({
            method: "POST",
            url: "/api/contests/create",
            data: angular.toJson(form)
        }).success(function (data, status, headers, config) {
            deferred.resolve(data);
        }).error(function (response) {
            deferred.reject(response);
        });
        return deferred.promise;
    };

    return service;
});

/**
 * New Game Dialog Controller
 * @author lawrence.daniels@gmail.com
 */
app.controller('NewGameDialogCtrl', ['$scope', '$modalInstance', function ($scope, $modalInstance) {
    $scope.form = {};

    $scope.ok = function () {
        $modalInstance.close($scope.form);
    };

    $scope.cancel = function () {
        $modalInstance.dismiss('cancel');
    };
}]);
