/**
 * Processing Tools Dialog Controller
 * @author lawrence.daniels@gmail.com
 */
angular
	.module('shocktrade')
	.controller('ProcessingToolsDialogCtrl', 
			['$scope', '$log', '$modalInstance', 'AdminService', 'MySession',
	 function($scope, $log, $modalInstance, AdminService, MySession) {

		$scope.tools = [
		    { id:"CIK", name: "CIK Update" },
		    { id:"KEYSTATS", name: "Key Statistics Update" },
		    { id:"QUOTE_CSV", name: "CSV Quote Update" },
		    { id:"QUOTE_RT", name: "Realtime Quote Update" },
		    { id:"PROFILE_UPDATE", name: "Stock Profile Update" }
		];
		
		$scope.params = {
			"symbol": null,
			"tool": $scope.tools[0].id
		}
		
		$scope.init = function() {
			// get the stock ticker
			var stockTickerScope = angular.element($("#stockTicker")).scope();
			if(stockTickerScope) {
				$scope.params.symbol = stockTickerScope.ticker;
			}
		}
		
		$scope.ok = function() {
			// get the parameters
			var symbol = extractSymbol($scope.params.symbol);
			var tool = $scope.params.tool;
			
			// invoke the process
			AdminService.invokeProcess(tool, symbol).then(
				function(response) {
					$log.info("Process " + tool + "/" + symbol + " completed successfully");
					$modalInstance.close(response.data);
				},
				function(err) {
					$scope.status = "Process " + tool + " failed";
				});
		}

		$scope.cancel = function() {
			$modalInstance.dismiss('cancel');
		}		
		
		function extractSymbol(ticker) {
			var index = ticker.indexOf(' ');
			return (index !== -1) ? ticker.substring(0, index).trim() : ticker.trim();
		}

}]);