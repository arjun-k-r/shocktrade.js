var app = angular.module('shocktrade');

app.controller('AdminCtrl', ['$scope', 'AdminService', function($scope, AdminService) {	
	// setup page loading variables
	$scope.message = "";
	$scope.sessions = [];
	$scope.bugReport = {};
	$scope.bugReports = [];
	
	$scope.tab = 0;
	$scope.tabs = [{
			"name" : "Sessions",
			"imageURL" : "/assets/images/objects/sessions.png",
			"path" : "/assets/views/admin/sessions.htm",
			"active" : true
		},{
			"name" : "Blog Postings",
			"imageURL" : "/assets/images/objects/blog.png",
			"path" : "/assets/views/blog/management.htm",
			"active" : false
		},{
			"name" : "Bug Reports",
			"imageURL" : "/assets/images/objects/bug.gif",
			"path" : "/assets/views/admin/bug_reports.htm",
			"active" : false
		}];
	
	// set the initial URL
	$scope.adminURL = $scope.tabs[0].path;
	
	$scope.changeTab = function(tabIndex, tab, event) {
		// make all of the tabs inactive
		for(var n = 0; n < $scope.tabs.length; n++) {
			$scope.tabs[n].active = false;
		}

		// set the specific tab
		$scope.tabs[tabIndex].active = true;
		$scope.tab = tabIndex;
		  
		if(tab.path != "") {
			console.log("Changing Admin tab to '" + tab.path + "'");
			$scope.adminURL = tab.path;
		}
		  
		// prevent the default action
		if(event) {
			event.preventDefault();
		};
	};
	
	$scope.createBugReport = function() {
		$scope.startLoading();
		$scope.message = "";
		AdminService.createBugReport($scope.bugReport).then(
			function(data) {
				$scope.bugReport = data;
				$scope.stopLoading();
			},
			function(err) {
				console.log("Error: Bug Reports - " + JSON.stringify($scope.bugReport) + "-" + data + " (" + status + ")");
				$scope.message = "Failed to save bug report";
				$scope.stopLoading();
			});
	};
	
	$scope.getBugReport = function(id) {
		$scope.startLoading();
		$scope.message = "";
		AdminService.getBugReport(id).then(
			function(data) {
				$scope.bugReport = data;
				$scope.stopLoading();
			},
			function(err) {
				console.log("Error: Bug Report #" + angular.toJson(id) + "-" + data + "(" + status + ")");
				$scope.message = "Failed to load bug report #" + angular.toJson(id);
				$scope.stopLoading();
			});
	};
	
	$scope.loadBugReports = function() {
		$scope.startLoading();
		$scope.message = "";
		AdminService.getBugReports().then(
			function(data) {
				$scope.bugReports = data;
				$scope.stopLoading();
			},
			function(err) {
				console.log("Error: Bug Reports - " + data + "(" + status + ")");
				$scope.message = "Failed to load bug reports";
				$scope.stopLoading();
			});	
	};
	
	$scope.removeBugReport = function(id) {
		$scope.startLoading();
		$scope.message = "";
		AdminService.removeBugReport(id).then(
			function(data) {
				$scope.stopLoading();
				$scope.bugReport = data;
				$scope.loadBugReports();
			},
			function(err) {
				console.log("Error: Bug Reports - Player #" + userId + "-" + data + "(" + status + ")");
				$scope.message = "Failed to remove bug report";
				$scope.stopLoading();
			});
	};
	
	$scope.loadSessions = function() {
		AdminService.getSessions().then(
			function(data) {
				$scope.sessions = data;
			},
			function(err) {
				console.log("Error: Sessions - Player #" + userId + "-" + data + "(" + status + ")");
			});		
	};	
	
}]);