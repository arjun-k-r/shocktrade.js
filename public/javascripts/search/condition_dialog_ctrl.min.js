/**
 * Condition Dialog Pop-pop Controller
 * @author lawrence.daniels@gmail.com
 */
angular
	.module('shocktrade')
	.controller('ConditionDialogCtrl', ['$scope', '$log', '$modalInstance', 'MySession',
	                            function($scope, $log, $modalInstance, MySession) {
		
		$scope.selection = { };
		
		$scope.queryFields = [
		    { id:"BETA", name: "Beta" },                  
		    { id:"CHANGE", name: "Change" },
		    { id:"LAST_TRADE", name: "Last" },
		    { id:"OPEN", name: "Open" },
		    { id:"CLOSE", name: "Close" },
		    { id:"HIGH", name: "High" },
		    { id:"LOW", name: "Low" },
		    { id:"SPREAD", name: "Spread" },
		    { id:"VOLUME", name: "Volume" }
		];
		
		$scope.operators = [ "=", ">=", ">", "<", "<=" ];
		
		$scope.addCondition = function(filter) {
			// create the condition
			var condition = {
				field: $scope.selection.field,
				operator: $scope.selection.operator,
				value: parseFloat($scope.selection.value)
			};
			
			// add it to the filter
			filter.conditions.push(condition);
			$scope.selection = { };
		};
		
		$scope.getFilters = function() {
			return MySession.userProfile.filters;
		};

		$scope.getSelectedFilter = function() {
			var scope = angular.element($("#search_main")).scope();
			return scope.filter;
		};
		
		$scope.ok = function() {
			var selectedFilter = $scope.getSelectedFilter();
			$modalInstance.close(selectedFilter);
		};

		$scope.cancel = function() {
			$scope.selection = { };
			$modalInstance.dismiss('cancel');
		};		

}]);